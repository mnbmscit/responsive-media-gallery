/**
 * Galleria v 1.3 2013-05-22
 * http://galleria.io
 *
 * Licensed under the MIT license
 * https://raw.github.com/aino/galleria/master/LICENSE
 *
 */(function(e,t,n){var r=this,i=r.document,s=e(i),o=e(r),u=Array.prototype,a=1.3,f=!0,l=3e4,c=!1,h=navigator.userAgent.toLowerCase(),p=r.location.hash.replace(/#\//,""),d=function(){},v=function(){return!1},m=function(){var e=3,t=i.createElement("div"),r=t.getElementsByTagName("i");do t.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->";while(r[0]);return e>4?e:n}(),g=function(){return{html:i.documentElement,body:i.body,head:i.getElementsByTagName("head")[0],title:i.title}},y=r.parent!==r.self,b="data ready thumbnail loadstart loadfinish image play pause progress fullscreen_enter fullscreen_exit idle_enter idle_exit rescale lightbox_open lightbox_close lightbox_image",w=function(){var t=[];e.each(b.split(" "),function(e,n){t.push(n);/_/.test(n)&&t.push(n.replace(/_/g,""))});return t}(),E=function(t){var n;if(typeof t!="object")return t;e.each(t,function(r,i){if(/^[a-z]+_/.test(r)){n="";e.each(r.split("_"),function(e,t){n+=e>0?t.substr(0,1).toUpperCase()+t.substr(1):t});t[n]=i;delete t[r]}});return t},S=function(n){return e.inArray(n,w)>-1?t[n.toUpperCase()]:n},x={youtube:{reg:/https?:\/\/(?:[a-zA_Z]{2,3}.)?(?:youtube\.com\/watch\?)((?:[\w\d\-\_\=]+&amp;(?:amp;)?)*v(?:&lt;[A-Z]+&gt;)?=([0-9a-zA-Z\-\_]+))/i,embed:function(e){return"http://www.youtube.com/embed/"+e},getThumb:function(t,n,i){i=i||d;e.getJSON(r.location.protocol+"//gdata.youtube.com/feeds/api/videos/"+t+"?v=2&alt=json-in-script&callback=?",function(e){try{n(e.entry.media$group.media$thumbnail[0].url)}catch(t){i()}})}},vimeo:{reg:/https?:\/\/(?:www\.)?(vimeo\.com)\/(?:hd#)?([0-9]+)/i,embed:function(e){return"http://player.vimeo.com/video/"+e},getThumb:function(t,n,r){r=r||d;e.getJSON("http://vimeo.com/api/v2/video/"+t+".json?callback=?",function(e){try{n(e[0].thumbnail_medium)}catch(t){r()}})}},dailymotion:{reg:/https?:\/\/(?:www\.)?(dailymotion\.com)\/video\/([^_]+)/,embed:function(e){return"http://www.dailymotion.com/embed/video/"+e},getThumb:function(t,n,r){r=r||d;e.getJSON("https://api.dailymotion.com/video/"+t+"?fields=thumbnail_medium_url&callback=?",function(e){try{n(e.thumbnail_medium_url)}catch(t){r()}})}}},T=function(e){var t;for(var n in x){t=e&&e.match(x[n].reg);if(t&&t.length)return{id:t[2],provider:n}}return!1},N={support:function(){var e=g().html;return!y&&(e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullScreen)}(),callback:d,enter:function(e,t,n){this.instance=e;this.callback=t||d;n=n||g().html;n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullScreen&&n.webkitRequestFullScreen()},exit:function(e){this.callback=e||d;i.exitFullscreen?i.exitFullscreen():i.mozCancelFullScreen?i.mozCancelFullScreen():i.webkitCancelFullScreen&&i.webkitCancelFullScreen()},instance:null,listen:function(){if(!this.support)return;var e=function(){if(!N.instance)return;var e=N.instance._fullscreen;i.fullscreen||i.mozFullScreen||i.webkitIsFullScreen?e._enter(N.callback):e._exit(N.callback)};i.addEventListener("fullscreenchange",e,!1);i.addEventListener("mozfullscreenchange",e,!1);i.addEventListener("webkitfullscreenchange",e,!1)}},C=[],k=[],L=!1,A=!1,O=[],M=function(n){t.theme=n;e.each(O,function(e,t){t._initialized||t._init.call(t)});O=[]},_=function(){return{clearTimer:function(n){e.each(t.get(),function(){this.clearTimer(n)})},addTimer:function(n){e.each(t.get(),function(){this.addTimer(n)})},array:function(e){return u.slice.call(e,0)},create:function(e,t){t=t||"div";var n=i.createElement(t);n.className=e;return n},removeFromArray:function(t,n){e.each(t,function(e,r){if(r==n){t.splice(e,1);return!1}});return t},getScriptPath:function(t){t=t||e("script:last").attr("src");var n=t.split("/");if(n.length==1)return"";n.pop();return n.join("/")+"/"},animate:function(){var n=function(e){var t="transition WebkitTransition MozTransition OTransition".split(" "),n;if(r.opera)return!1;for(n=0;t[n];n++)if(typeof e[t[n]]!="undefined")return t[n];return!1}((i.body||i.documentElement).style),s={MozTransition:"transitionend",OTransition:"oTransitionEnd",WebkitTransition:"webkitTransitionEnd",transition:"transitionend"}[n],o={_default:[.25,.1,.25,1],galleria:[.645,.045,.355,1],galleriaIn:[.55,.085,.68,.53],galleriaOut:[.25,.46,.45,.94],ease:[.25,0,.25,1],linear:[.25,.25,.75,.75],"ease-in":[.42,0,1,1],"ease-out":[0,0,.58,1],"ease-in-out":[.42,0,.58,1]},u=function(t,n,r){var i={};r=r||"transition";e.each("webkit moz ms o".split(" "),function(){i["-"+this+"-"+r]=n});t.css(i)},a=function(e){u(e,"none","transition");if(t.WEBKIT&&t.TOUCH){u(e,"translate3d(0,0,0)","transform");if(e.data("revert")){e.css(e.data("revert"));e.data("revert",null)}}},f,l,c,h,p,v,m;return function(i,g,y){y=e.extend({duration:400,complete:d,stop:!1},y);i=e(i);if(!y.duration){i.css(g);y.complete.call(i[0]);return}if(!n){i.animate(g,y);return}if(y.stop){i.unbind(s);a(i)}f=!1;e.each(g,function(e,t){m=i.css(e);_.parseValue(m)!=_.parseValue(t)&&(f=!0);i.css(e,m)});if(!f){r.setTimeout(function(){y.complete.call(i[0])},y.duration);return}l=[];c=y.easing in o?o[y.easing]:o._default;h=" "+y.duration+"ms"+" cubic-bezier("+c.join(",")+")";r.setTimeout(function(n,r,i,s){return function(){n.one(r,function(e){return function(){a(e);y.complete.call(e[0])}}(n));if(t.WEBKIT&&t.TOUCH){p={};v=[0,0,0];e.each(["left","top"],function(e,t){if(t in i){v[e]=_.parseValue(i[t])-_.parseValue(n.css(t))+"px";p[t]=i[t];delete i[t]}});if(v[0]||v[1]){n.data("revert",p);l.push("-webkit-transform"+s);u(n,"translate3d("+v.join(",")+")","transform")}}e.each(i,function(e,t){l.push(e+s)});u(n,l.join(","));n.css(i)}}(i,s,g,h),2)}}(),removeAlpha:function(e){e instanceof jQuery&&(e=e[0]);if(m<9&&e){var t=e.style,n=e.currentStyle,r=n&&n.filter||t.filter||"";/alpha/.test(r)&&(t.filter=r.replace(/alpha\([^)]*\)/i,""))}},forceStyles:function(t,n){t=e(t);t.attr("style")&&t.data("styles",t.attr("style")).removeAttr("style");t.css(n)},revertStyles:function(){e.each(_.array(arguments),function(t,n){n=e(n);n.removeAttr("style");n.attr("style","");n.data("styles")&&n.attr("style",n.data("styles")).data("styles",null)})},moveOut:function(e){_.forceStyles(e,{position:"absolute",left:-1e4})},moveIn:function(){_.revertStyles.apply(_,_.array(arguments))},hide:function(t,n,r){r=r||d;var i=e(t);t=i[0];i.data("opacity")||i.data("opacity",i.css("opacity"));var s={opacity:0};if(n){var o=m<9&&t?function(){_.removeAlpha(t);t.style.visibility="hidden";r.call(t)}:r;_.animate(t,s,{duration:n,complete:o,stop:!0})}else if(m<9&&t){_.removeAlpha(t);t.style.visibility="hidden"}else i.css(s)},show:function(t,n,r){r=r||d;var i=e(t);t=i[0];var s=parseFloat(i.data("opacity"))||1,o={opacity:s};if(n){if(m<9){i.css("opacity",0);t.style.visibility="visible"}var u=m<9&&t?function(){o.opacity==1&&_.removeAlpha(t);r.call(t)}:r;_.animate(t,o,{duration:n,complete:u,stop:!0})}else if(m<9&&o.opacity==1&&t){_.removeAlpha(t);t.style.visibility="visible"}else i.css(o)},wait:function(n){n=e.extend({until:v,success:d,error:function(){t.raise("Could not complete wait function.")},timeout:3e3},n);var i=_.timestamp(),s,o,u=function(){o=_.timestamp();s=o-i;if(n.until(s)){n.success();return!1}if(typeof n.timeout=="number"&&o>=i+n.timeout){n.error();return!1}r.setTimeout(u,10)};r.setTimeout(u,10)},toggleQuality:function(e,t){if(m!==7&&m!==8||!e||e.nodeName.toUpperCase()!="IMG")return;typeof t=="undefined"&&(t=e.style.msInterpolationMode==="nearest-neighbor");e.style.msInterpolationMode=t?"bicubic":"nearest-neighbor"},insertStyleTag:function(t,n){if(n&&e("#"+n).length)return;var r=i.createElement("style");n&&(r.id=n);g().head.appendChild(r);if(r.styleSheet)r.styleSheet.cssText=t;else{var s=i.createTextNode(t);r.appendChild(s)}},loadScript:function(t,n){var r=!1,i=e("<script>").attr({src:t,async:!0}).get(0);i.onload=i.onreadystatechange=function(){if(!r&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){r=!0;i.onload=i.onreadystatechange=null;typeof n=="function"&&n.call(this,this)}};g().head.appendChild(i)},parseValue:function(e){if(typeof e=="number")return e;if(typeof e=="string"){var t=e.match(/\-?\d|\./g);return t&&t.constructor===Array?t.join("")*1:0}return 0},timestamp:function(){return(new Date).getTime()},loadCSS:function(r,s,o){var u,a;e("link[rel=stylesheet]").each(function(){if((new RegExp(r)).test(this.href)){u=this;return!1}});if(typeof s=="function"){o=s;s=n}o=o||d;if(u){o.call(u,u);return u}a=i.styleSheets.length;if(e("#"+s).length){e("#"+s).attr("href",r);a--}else{u=e("<link>").attr({rel:"stylesheet",href:r,id:s}).get(0);var f=e('link[rel="stylesheet"], style');f.length?f.get(0).parentNode.insertBefore(u,f[0]):g().head.appendChild(u);if(m&&a>=31){t.raise("You have reached the browser stylesheet limit (31)",!0);return}}if(typeof o=="function"){var l=e("<s>").attr("id","galleria-loader").hide().appendTo(g().body);_.wait({until:function(){return l.height()==1},success:function(){l.remove();o.call(u,u)},error:function(){l.remove();t.raise("Theme CSS could not load after 20 sec. "+(t.QUIRK?"Your browser is in Quirks Mode, please add a correct doctype.":"Please download the latest theme at http://galleria.io/customer/."),!0)},timeout:5e3})}return u}}}(),D=function(){var t=function(t,n,r,i){var s=this.getOptions("easing"),o=this.getStageWidth(),u={left:o*(t.rewind?-1:1)},a={left:0};if(r){u.opacity=0;a.opacity=1}else u.opacity=1;e(t.next).css(u);_.animate(t.next,a,{duration:t.speed,complete:function(e){return function(){n();e.css({left:0})}}(e(t.next).add(t.prev)),queue:!1,easing:s});i&&(t.rewind=!t.rewind);if(t.prev){u={left:0};a={left:o*(t.rewind?1:-1)};if(r){u.opacity=1;a.opacity=0}e(t.prev).css(u);_.animate(t.prev,a,{duration:t.speed,queue:!1,easing:s,complete:function(){e(this).css("opacity",0)}})}};return{active:!1,init:function(e,t,n){D.effects.hasOwnProperty(e)&&D.effects[e].call(this,t,n)},effects:{fade:function(t,n){e(t.next).css({opacity:0,left:0});_.animate(t.next,{opacity:1},{duration:t.speed,complete:n});if(t.prev){e(t.prev).css("opacity",1).show();_.animate(t.prev,{opacity:0},{duration:t.speed})}},flash:function(t,n){e(t.next).css({opacity:0,left:0});t.prev?_.animate(t.prev,{opacity:0},{duration:t.speed/2,complete:function(){_.animate(t.next,{opacity:1},{duration:t.speed,complete:n})}}):_.animate(t.next,{opacity:1},{duration:t.speed,complete:n})},pulse:function(t,n){t.prev&&e(t.prev).hide();e(t.next).css({opacity:0,left:0}).show();_.animate(t.next,{opacity:1},{duration:t.speed,complete:n})},slide:function(e,n){t.apply(this,_.array(arguments))},fadeslide:function(e,n){t.apply(this,_.array(arguments).concat([!0]))},doorslide:function(e,n){t.apply(this,_.array(arguments).concat([!1,!0]))}}}}();N.listen();t=r.Galleria=function(){var u=this;this._options={};this._playing=!1;this._playtime=5e3;this._active=null;this._queue={length:0};this._data=[];this._dom={};this._thumbnails=[];this._layers=[];this._initialized=!1;this._firstrun=!1;this._stageWidth=0;this._stageHeight=0;this._target=n;this._binds=[];this._id=parseInt(Math.random()*1e4,10);var a="container stage images image-nav image-nav-left image-nav-right info info-text info-title info-description thumbnails thumbnails-list thumbnails-container thumb-nav-left thumb-nav-right loader counter tooltip",f="current total";e.each(a.split(" "),function(e,t){u._dom[t]=_.create("galleria-"+t)});e.each(f.split(" "),function(e,t){u._dom[t]=_.create("galleria-"+t,"span")});var l=this._keyboard={keys:{UP:38,DOWN:40,LEFT:37,RIGHT:39,RETURN:13,ESCAPE:27,BACKSPACE:8,SPACE:32},map:{},bound:!1,press:function(e){var t=e.keyCode||e.which;t in l.map&&typeof l.map[t]=="function"&&l.map[t].call(u,e)},attach:function(e){var t,n;for(t in e)if(e.hasOwnProperty(t)){n=t.toUpperCase();n in l.keys?l.map[l.keys[n]]=e[t]:l.map[n]=e[t]}if(!l.bound){l.bound=!0;s.bind("keydown",l.press)}},detach:function(){l.bound=!1;l.map={};s.unbind("keydown",l.press)}},c=this._controls={0:n,1:n,active:0,swap:function(){c.active=c.active?0:1},getActive:function(){return u._options.swipe?c.slides[u._active]:c[c.active]},getNext:function(){return u._options.swipe?c.slides[u.getNext(u._active)]:c[1-c.active]},slides:[]},p=this._carousel={next:u.$("thumb-nav-right"),prev:u.$("thumb-nav-left"),width:0,current:0,max:0,hooks:[],update:function(){var t=0,n=0,r=[0];e.each(u._thumbnails,function(i,s){if(s.ready){t+=s.outerWidth||e(s.container).outerWidth(!0);r[i+1]=t;n=Math.max(n,s.outerHeight||e(s.container).outerHeight(!0))}});u.$("thumbnails").css({width:t,height:n});p.max=t;p.hooks=r;p.width=u.$("thumbnails-list").width();p.setClasses();u.$("thumbnails-container").toggleClass("galleria-carousel",t>p.width);p.width=u.$("thumbnails-list").width()},bindControls:function(){var e;p.next.bind("click",function(t){t.preventDefault();if(u._options.carouselSteps==="auto"){for(e=p.current;e<p.hooks.length;e++)if(p.hooks[e]-p.hooks[p.current]>p.width){p.set(e-2);break}}else p.set(p.current+u._options.carouselSteps)});p.prev.bind("click",function(t){t.preventDefault();if(u._options.carouselSteps==="auto")for(e=p.current;e>=0;e--){if(p.hooks[p.current]-p.hooks[e]>p.width){p.set(e+2);break}if(e===0){p.set(0);break}}else p.set(p.current-u._options.carouselSteps)})},set:function(e){e=Math.max(e,0);while(p.hooks[e-1]+p.width>=p.max&&e>=0)e--;p.current=e;p.animate()},getLast:function(e){return(e||p.current)-1},follow:function(e){if(e===0||e===p.hooks.length-2){p.set(e);return}var t=p.current;while(p.hooks[t]-p.hooks[p.current]<p.width&&t<=p.hooks.length)t++;e-1<p.current?p.set(e-1):e+2>t&&p.set(e-t+p.current+2)},setClasses:function(){p.prev.toggleClass("disabled",!p.current);p.next.toggleClass("disabled",p.hooks[p.current]+p.width>=p.max)},animate:function(e){p.setClasses();var t=p.hooks[p.current]*-1;if(isNaN(t))return;_.animate(u.get("thumbnails"),{left:t},{duration:u._options.carouselSpeed,easing:u._options.easing,queue:!1})}},d=this._tooltip={initialized:!1,open:!1,timer:"tooltip"+u._id,swapTimer:"swap"+u._id,init:function(){d.initialized=!0;var e=".galleria-tooltip{padding:3px 8px;max-width:50%;background:#ffe;color:#000;z-index:3;position:absolute;font-size:11px;line-height:1.3;opacity:0;box-shadow:0 0 2px rgba(0,0,0,.4);-moz-box-shadow:0 0 2px rgba(0,0,0,.4);-webkit-box-shadow:0 0 2px rgba(0,0,0,.4);}";_.insertStyleTag(e,"galleria-tooltip");u.$("tooltip").css({opacity:.8,visibility:"visible",display:"none"})},move:function(e){var t=u.getMousePosition(e).x,n=u.getMousePosition(e).y,r=u.$("tooltip"),i=t,s=n,o=r.outerHeight(!0)+1,a=r.outerWidth(!0),f=o+15,l=u.$("container").width()-a-2,c=u.$("container").height()-o-2;if(!isNaN(i)&&!isNaN(s)){i+=10;s-=o+8;i=Math.max(0,Math.min(l,i));s=Math.max(0,Math.min(c,s));n<f&&(s=f);r.css({left:i,top:s})}},bind:function(n,r){if(t.TOUCH)return;d.initialized||d.init();var i=function(){u.$("container").unbind("mousemove",d.move);u.clearTimer(d.timer);u.$("tooltip").stop().animate({opacity:0},200,function(){u.$("tooltip").hide();u.addTimer(d.swapTimer,function(){d.open=!1},1e3)})},s=function(t,n){d.define(t,n);e(t).hover(function(){u.clearTimer(d.swapTimer);u.$("container").unbind("mousemove",d.move).bind("mousemove",d.move).trigger("mousemove");d.show(t);u.addTimer(d.timer,function(){u.$("tooltip").stop().show().animate({opacity:1});d.open=!0},d.open?0:500)},i).click(i)};typeof r=="string"?s(n in u._dom?u.get(n):n,r):e.each(n,function(e,t){s(u.get(e),t)})},show:function(t){t=e(t in u._dom?u.get(t):t);var n=t.data("tt"),i=function(e){r.setTimeout(function(e){return function(){d.move(e)}}(e),10);t.unbind("mouseup",i)};n=typeof n=="function"?n():n;if(!n)return;u.$("tooltip").html(n.replace(/\s/,"&#160;"));t.bind("mouseup",i)},define:function(t,n){if(typeof n!="function"){var r=n;n=function(){return r}}t=e(t in u._dom?u.get(t):t).data("tt",n);d.show(t)}},v=this._fullscreen={scrolled:0,crop:n,active:!1,prev:e(),beforeEnter:function(e){e()},beforeExit:function(e){e()},keymap:u._keyboard.map,parseCallback:function(t,n){return D.active?function(){typeof t=="function"&&t.call(u);var r=u._controls.getActive(),i=u._controls.getNext();u._scaleImage(i);u._scaleImage(r);n&&u._options.trueFullscreen&&e(r.container).add(i.container).trigger("transitionend")}:t},enter:function(e){v.beforeEnter(function(){e=v.parseCallback(e,!0);if(u._options.trueFullscreen&&N.support){v.active=!0;_.forceStyles(u.get("container"),{width:"100%",height:"100%"});u.rescale();if(t.MAC)if(t.WEBKIT&&(!t.SAFARI||!/version\/[1-5]/.test(h))){u.$("container").css("opacity",0).addClass("fullscreen");r.setTimeout(function(){v.scale();u.$("container").css("opacity",1)},50)}else{u.$("stage").css("opacity",0);r.setTimeout(function(){v.scale();u.$("stage").css("opacity",1)},4)}else u.$("container").addClass("fullscreen");o.resize(v.scale);N.enter(u,e,u.get("container"))}else{v.scrolled=o.scrollTop();t.TOUCH||r.scrollTo(0,0);v._enter(e)}})},_enter:function(s){v.active=!0;y&&(v.iframe=function(){var n,s=i.referrer,o=i.createElement("a"),u=r.location;o.href=s;if(o.protocol!=u.protocol||o.hostname!=u.hostname||o.port!=u.port){t.raise("Parent fullscreen not available. Iframe protocol, domains and ports must match.");return!1}v.pd=r.parent.document;e(v.pd).find("iframe").each(function(){var e=this.contentDocument||this.contentWindow.document;if(e===i){n=this;return!1}});return n}());_.hide(u.getActiveImage());if(y&&v.iframe){v.iframe.scrolled=e(r.parent).scrollTop();r.parent.scrollTo(0,0)}var a=u.getData(),f=u._options,l=!u._options.trueFullscreen||!N.support,c={height:"100%",overflow:"hidden",margin:0,padding:0};if(l){u.$("container").addClass("fullscreen");v.prev=u.$("container").prev();v.prev.length||(v.parent=u.$("container").parent());u.$("container").appendTo("body");_.forceStyles(u.get("container"),{position:t.TOUCH?"absolute":"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:1e4});_.forceStyles(g().html,c);_.forceStyles(g().body,c)}if(y&&v.iframe){_.forceStyles(v.pd.documentElement,c);_.forceStyles(v.pd.body,c);_.forceStyles(v.iframe,e.extend(c,{width:"100%",height:"100%",top:0,left:0,position:"fixed",zIndex:1e4,border:"none"}))}v.keymap=e.extend({},u._keyboard.map);u.attachKeyboard({escape:u.exitFullscreen,right:u.next,left:u.prev});v.crop=f.imageCrop;f.fullscreenCrop!=n&&(f.imageCrop=f.fullscreenCrop);if(a&&a.big&&a.image!==a.big){var h=new t.Picture,p=h.isCached(a.big),d=u.getIndex(),m=u._thumbnails[d];u.trigger({type:t.LOADSTART,cached:p,rewind:!1,index:d,imageTarget:u.getActiveImage(),thumbTarget:m,galleriaData:a});h.load(a.big,function(n){u._scaleImage(n,{complete:function(n){u.trigger({type:t.LOADFINISH,cached:p,index:d,rewind:!1,imageTarget:n.image,thumbTarget:m});var r=u._controls.getActive().image;r&&e(r).width(n.image.width).height(n.image.height).attr("style",e(n.image).attr("style")).attr("src",n.image.src)}})})}u.rescale(function(){u.addTimer(!1,function(){l&&_.show(u.getActiveImage());typeof s=="function"&&s.call(u)},100);u.trigger(t.FULLSCREEN_ENTER)});l?o.resize(v.scale):_.show(u.getActiveImage())},scale:function(){u.rescale()},exit:function(e){v.beforeExit(function(){e=v.parseCallback(e);u._options.trueFullscreen&&N.support?N.exit(e):v._exit(e)})},_exit:function(e){v.active=!1;var n=!u._options.trueFullscreen||!N.support,i=u.$("container").removeClass("fullscreen");v.parent?v.parent.prepend(i):i.insertAfter(v.prev);if(n){_.hide(u.getActiveImage());_.revertStyles(u.get("container"),g().html,g().body);t.TOUCH||r.scrollTo(0,v.scrolled)}if(y&&v.iframe){_.revertStyles(v.pd.documentElement,v.pd.body,v.iframe);v.iframe.scrolled&&r.parent.scrollTo(0,v.iframe.scrolled)}u.detachKeyboard();u.attachKeyboard(v.keymap);u._options.imageCrop=v.crop;var s=u.getData().big,a=u._controls.getActive().image;!u.getData().iframe&&a&&s&&s==a.src&&r.setTimeout(function(e){return function(){a.src=e}}(u.getData().image),1);u.rescale(function(){u.addTimer(!1,function(){n&&_.show(u.getActiveImage());typeof e=="function"&&e.call(u);o.trigger("resize")},50);u.trigger(t.FULLSCREEN_EXIT)});o.unbind("resize",v.scale)}},b=this._idle={trunk:[],bound:!1,active:!1,add:function(t,n,r,i){if(!t)return;b.bound||b.addEvent();t=e(t);if(typeof r=="boolean"){i=r;r={}}r=r||{};var s={},o;for(o in n)n.hasOwnProperty(o)&&(s[o]=t.css(o));t.data("idle",{from:e.extend(s,r),to:n,complete:!0,busy:!1});i?t.css(n):b.addTimer();b.trunk.push(t)},remove:function(t){t=e(t);e.each(b.trunk,function(e,n){if(n&&n.length&&!n.not(t).length){t.css(t.data("idle").from);b.trunk.splice(e,1)}});if(!b.trunk.length){b.removeEvent();u.clearTimer(b.timer)}},addEvent:function(){b.bound=!0;u.$("container").bind("mousemove click",b.showAll);u._options.idleMode=="hover"&&u.$("container").bind("mouseleave",b.hide)},removeEvent:function(){b.bound=!1;u.$("container").bind("mousemove click",b.showAll);u._options.idleMode=="hover"&&u.$("container").unbind("mouseleave",b.hide)},addTimer:function(){if(u._options.idleMode=="hover")return;u.addTimer("idle",function(){b.hide()},u._options.idleTime)},hide:function(){if(!u._options.idleMode||u.getIndex()===!1||u.getData().iframe)return;u.trigger(t.IDLE_ENTER);var n=b.trunk.length;e.each(b.trunk,function(e,t){var r=t.data("idle");if(!r)return;t.data("idle").complete=!1;_.animate(t,r.to,{duration:u._options.idleSpeed,complete:function(){e==n-1&&(b.active=!1)}})})},showAll:function(){u.clearTimer("idle");e.each(b.trunk,function(e,t){b.show(t)})},show:function(n){var r=n.data("idle");if(!b.active||!r.busy&&!r.complete){r.busy=!0;u.trigger(t.IDLE_EXIT);u.clearTimer("idle");_.animate(n,r.from,{duration:u._options.idleSpeed/2,complete:function(){b.active=!0;e(n).data("idle").busy=!1;e(n).data("idle").complete=!0}})}b.addTimer()}},w=this._lightbox={width:0,height:0,initialized:!1,active:null,image:null,elems:{},keymap:!1,init:function(){if(w.initialized)return;w.initialized=!0;var n="overlay box content shadow title info close prevholder prev nextholder next counter image",r={},i=u._options,s="",o="position:absolute;",a="lightbox-",f={overlay:"position:fixed;display:none;opacity:"+i.overlayOpacity+";filter:alpha(opacity="+i.overlayOpacity*100+");top:0;left:0;width:100%;height:100%;background:"+i.overlayBackground+";z-index:99990",box:"position:fixed;display:none;width:400px;height:400px;top:50%;left:50%;margin-top:-200px;margin-left:-200px;z-index:99991",shadow:o+"background:#000;width:100%;height:100%;",content:o+"background-color:#fff;top:10px;left:10px;right:10px;bottom:10px;overflow:hidden",info:o+"bottom:10px;left:10px;right:10px;color:#444;font:11px/13px arial,sans-serif;height:13px",close:o+"top:10px;right:10px;height:20px;width:20px;background:#fff;text-align:center;cursor:pointer;color:#444;font:16px/22px arial,sans-serif;z-index:99999",image:o+"top:10px;left:10px;right:10px;bottom:30px;overflow:hidden;display:block;",prevholder:o+"width:50%;top:0;bottom:40px;cursor:pointer;",nextholder:o+"width:50%;top:0;bottom:40px;right:-1px;cursor:pointer;",prev:o+"top:50%;margin-top:-20px;height:40px;width:30px;background:#fff;left:20px;display:none;text-align:center;color:#000;font:bold 16px/36px arial,sans-serif",next:o+"top:50%;margin-top:-20px;height:40px;width:30px;background:#fff;right:20px;left:auto;display:none;font:bold 16px/36px arial,sans-serif;text-align:center;color:#000",title:"float:left",counter:"float:right;margin-left:8px;"},l=function(t){return t.hover(function(){e(this).css("color","#bbb")},function(){e(this).css("color","#444")})},c={};if(m&&m>7){f.nextholder+="background:#000;filter:alpha(opacity=0);";f.prevholder+="background:#000;filter:alpha(opacity=0);"}e.each(f,function(e,t){s+=".galleria-"+a+e+"{"+t+"}"});s+=".galleria-"+a+"box.iframe .galleria-"+a+"prevholder,"+".galleria-"+a+"box.iframe .galleria-"+a+"nextholder{"+"width:100px;height:100px;top:50%;margin-top:-70px}";_.insertStyleTag(s,"galleria-lightbox");e.each(n.split(" "),function(e,t){u.addElement("lightbox-"+t);r[t]=w.elems[t]=u.get("lightbox-"+t)});w.image=new t.Picture;e.each({box:"shadow content close prevholder nextholder",info:"title counter",content:"info image",prevholder:"prev",nextholder:"next"},function(t,n){var r=[];e.each(n.split(" "),function(e,t){r.push(a+t)});c[a+t]=r});u.append(c);e(r.image).append(w.image.container);e(g().body).append(r.overlay,r.box);l(e(r.close).bind("click",w.hide).html("&#215;"));e.each(["Prev","Next"],function(n,i){var s=e(r[i.toLowerCase()]).html(/v/.test(i)?"&#8249;&#160;":"&#160;&#8250;"),o=e(r[i.toLowerCase()+"holder"]);o.bind("click",function(){w["show"+i]()});if(m<8||t.TOUCH){s.show();return}o.hover(function(){s.show()},function(e){s.stop().fadeOut(200)})});e(r.overlay).bind("click",w.hide);t.IPAD&&(u._options.lightboxTransitionSpeed=0)},rescale:function(n){var r=Math.min(o.width()-40,w.width),i=Math.min(o.height()-60,w.height),s=Math.min(r/w.width,i/w.height),a=Math.round(w.width*s)+40,f=Math.round(w.height*s)+60,l={width:a,height:f,"margin-top":Math.ceil(f/2)*-1,"margin-left":Math.ceil(a/2)*-1};n?e(w.elems.box).css(l):e(w.elems.box).animate(l,{duration:u._options.lightboxTransitionSpeed,easing:u._options.easing,complete:function(){var n=w.image,r=u._options.lightboxFadeSpeed;u.trigger({type:t.LIGHTBOX_IMAGE,imageTarget:n.image});e(n.container).show();e(n.image).animate({opacity:1},r);_.show(w.elems.info,r)}})},hide:function(){w.image.image=null;o.unbind("resize",w.rescale);e(w.elems.box).hide();_.hide(w.elems.info);u.detachKeyboard();u.attachKeyboard(w.keymap);w.keymap=!1;_.hide(w.elems.overlay,200,function(){e(this).hide().css("opacity",u._options.overlayOpacity);u.trigger(t.LIGHTBOX_CLOSE)})},showNext:function(){w.show(u.getNext(w.active))},showPrev:function(){w.show(u.getPrev(w.active))},show:function(n){w.active=n=typeof n=="number"?n:u.getIndex()||0;w.initialized||w.init();u.trigger(t.LIGHTBOX_OPEN);if(!w.keymap){w.keymap=e.extend({},u._keyboard.map);u.attachKeyboard({escape:w.hide,right:w.showNext,left:w.showPrev})}o.unbind("resize",w.rescale);var i=u.getData(n),s=u.getDataLength(),a=u.getNext(n),f,l,c;_.hide(w.elems.info);try{for(c=u._options.preload;c>0;c--){l=new t.Picture;f=u.getData(a);l.preload("big"in f?f.big:f.image);a=u.getNext(a)}}catch(h){}w.image.isIframe=!!i.iframe;e(w.elems.box).toggleClass("iframe",!!i.iframe);w.image.load(i.iframe||i.big||i.image,function(t){if(t.isIframe){var a=e(r).width(),f=e(r).height();if(u._options.maxVideoSize){var l=Math.min(u._options.maxVideoSize/a,u._options.maxVideoSize/f);if(l<1){a*=l;f*=l}}w.width=a;w.height=f}else{w.width=t.original.width;w.height=t.original.height}e(t.image).css({width:t.isIframe?"100%":"100.1%",height:t.isIframe?"100%":"100.1%",top:0,zIndex:99998,opacity:0,visibility:"visible"});w.elems.title.innerHTML=i.title||"";w.elems.counter.innerHTML=n+1+" / "+s;o.resize(w.rescale);w.rescale()});e(w.elems.overlay).show().css("visibility","visible");e(w.elems.box).show()}},E=this._timer={trunk:{},add:function(e,t,n,i){e=e||(new Date).getTime();i=i||!1;this.clear(e);if(i){var s=t;t=function(){s();E.add(e,t,n)}}this.trunk[e]=r.setTimeout(t,n)},clear:function(e){var t=function(e){r.clearTimeout(this.trunk[e]);delete this.trunk[e]},n;if(!!e&&e in this.trunk)t.call(this,e);else if(typeof e=="undefined")for(n in this.trunk)this.trunk.hasOwnProperty(n)&&t.call(this,n)}};return this};t.prototype={constructor:t,init:function(r,i){i=E(i);this._original={target:r,options:i,data:null};this._target=this._dom.target=r.nodeName?r:e(r).get(0);this._original.html=this._target.innerHTML;k.push(this);if(!this._target){t.raise("Target not found",!0);return}this._options={autoplay:!1,carousel:!0,carouselFollow:!0,carouselSpeed:400,carouselSteps:"auto",clicknext:!1,dailymotion:{foreground:"%23EEEEEE",highlight:"%235BCEC5",background:"%23222222",logo:0,hideInfos:1},dataConfig:function(e){return{}},dataSelector:"img",dataSort:!1,dataSource:this._target,debug:n,dummy:n,easing:"galleria",extend:function(e){},fullscreenCrop:n,fullscreenDoubleTap:!0,fullscreenTransition:n,height:0,idleMode:!0,idleTime:3e3,idleSpeed:200,imageCrop:!1,imageMargin:0,imagePan:!1,imagePanSmoothness:12,imagePosition:"50%",imageTimeout:n,initialTransition:n,keepSource:!1,layerFollow:!0,lightbox:!1,lightboxFadeSpeed:200,lightboxTransitionSpeed:200,linkSourceImages:!0,maxScaleRatio:n,maxVideoSize:n,minScaleRatio:n,overlayOpacity:.85,overlayBackground:"#0b0b0b",pauseOnInteraction:!0,popupLinks:!1,preload:2,queue:!0,responsive:!0,show:0,showInfo:!0,showCounter:!0,showImagenav:!0,swipe:!0,thumbCrop:!0,thumbEventType:"click",thumbMargin:0,thumbQuality:"auto",thumbDisplayOrder:!0,thumbPosition:"50%",thumbnails:!0,touchTransition:n,transition:"fade",transitionInitial:n,transitionSpeed:400,trueFullscreen:!0,useCanvas:!1,vimeo:{title:0,byline:0,portrait:0,color:"aaaaaa"},wait:5e3,width:"auto",youtube:{modestbranding:1,autohide:1,color:"white",hd:1,rel:0,showinfo:0}};this._options.initialTransition=this._options.initialTransition||this._options.transitionInitial;i&&i.debug===!1&&(f=!1);i&&typeof i.imageTimeout=="number"&&(l=i.imageTimeout);i&&typeof i.dummy=="string"&&(c=i.dummy);t.TOUCH||(this._options.swipe=!1);e(this._target).children().hide();t.QUIRK&&t.raise("Your page is in Quirks mode, Galleria may not render correctly. Please validate your HTML and add a correct doctype.");typeof t.theme=="object"?this._init():O.push(this);return this},_init:function(){var n=this,s=this._options;if(this._initialized){t.raise("Init failed: Gallery instance already initialized.");return this}this._initialized=!0;if(!t.theme){t.raise("Init failed: No theme found.",!0);return this}e.extend(!0,s,t.theme.defaults,this._original.options,t.configure.options);if(s.swipe){s.clicknext=!1;s.imagePan=!1}(function(e){if(!("getContext"in e)){e=null;return}A=A||{elem:e,context:e.getContext("2d"),cache:{},length:0}})(i.createElement("canvas"));t.Fastclick.init(this.get("target"));this.bind(t.DATA,function(){r.screen&&r.screen.width&&Array.prototype.forEach&&this._data.forEach(function(e){var t="devicePixelRatio"in r?r.devicePixelRatio:1,n=Math.max(r.screen.width,r.screen.height);n*t<1024&&(e.big=e.image)});this._original.data=this._data;this.get("total").innerHTML=this.getDataLength();var e=this.$("container");n._options.height<2&&(n._userRatio=n._ratio=n._options.height);var i={width:0,height:0},s=function(){return n.$("stage").height()};_.wait({until:function(){i=n._getWH();e.width(i.width).height(i.height);return s()&&i.width&&i.height>50},success:function(){n._width=i.width;n._height=i.height;n._ratio=n._ratio||i.height/i.width;t.WEBKIT?r.setTimeout(function(){n._run()},1):n._run()},error:function(){s()?t.raise("Could not extract sufficient width/height of the gallery container. Traced measures: width:"+i.width+"px, height: "+i.height+"px.",!0):t.raise("Could not extract a stage height from the CSS. Traced height: "+s()+"px.",!0)},timeout:typeof this._options.wait=="number"?this._options.wait:!1})});this.append({"info-text":["info-title","info-description"],info:["info-text"],"image-nav":["image-nav-right","image-nav-left"],stage:["images","loader","counter","image-nav"],"thumbnails-list":["thumbnails"],"thumbnails-container":["thumb-nav-left","thumbnails-list","thumb-nav-right"],container:["stage","thumbnails-container","info","tooltip"]});_.hide(this.$("counter").append(this.get("current"),i.createTextNode(" / "),this.get("total")));this.setCounter("&#8211;");_.hide(n.get("tooltip"));this.$("container").addClass(t.TOUCH?"touch":"notouch");this._options.swipe||e.each(new Array(2),function(r){var i=new t.Picture;e(i.container).css({position:"absolute",top:0,left:0}).prepend(n._layers[r]=e(_.create("galleria-layer")).css({position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:2})[0]);n.$("images").append(i.container);n._controls[r]=i});this.$("images").css({position:"relative",top:0,left:0,width:"100%",height:"100%"});if(s.swipe){this.$("images").css({position:"absolute",top:0,left:0,width:0,height:"100%"});this.finger=new t.Finger(this.get("stage"),{onchange:function(e){n.setCounter(e);n.pause();n.show(e)},oncomplete:function(e){var r=Math.max(0,Math.min(parseInt(e,10),n.getDataLength()-1)),i=n.getData(r);if(!i)return;var s=i.iframe||(n.isFullscreen()&&"big"in i?i.big:i.image),o=n._controls.slides[r],u=o.isCached(s),a=n._thumbnails[r];n.trigger({type:t.IMAGE,cached:u,index:r,imageTarget:o.image,thumbTarget:a.image,galleriaData:i});n._options.carousel&&n._options.carouselFollow&&n._carousel.follow(r)}});this.bind(t.RESCALE,function(){this.finger.setup()});this.bind(t.IMAGE,function(t){n.setCounter(t.index);n.setInfo(t.index);e.each([this.getNext(),this.getPrev()],function(e,t){var r=n.getData(t),i=n._controls.slides[t],s=r.iframe||(n.isFullscreen()&&"big"in r?r.big:r.image);i.ready||n._controls.slides[t].load(s,function(e){n._scaleImage(e)})})})}this.$("thumbnails, thumbnails-list").css({overflow:"hidden",position
:"relative"});this.$("image-nav-right, image-nav-left").bind("click",function(e){s.clicknext&&e.stopPropagation();s.pauseOnInteraction&&n.pause();var t=/right/.test(this.className)?"next":"prev";n[t]()});e.each(["info","counter","image-nav"],function(e,t){s["show"+t.substr(0,1).toUpperCase()+t.substr(1).replace(/-/,"")]===!1&&_.moveOut(n.get(t.toLowerCase()))});this.load();!s.keepSource&&!m&&(this._target.innerHTML="");this.get("errors")&&this.appendChild("target","errors");this.appendChild("target","container");if(s.carousel){var u=0,a=s.show;this.bind(t.THUMBNAIL,function(){this.updateCarousel();++u==this.getDataLength()&&typeof a=="number"&&a>0&&this._carousel.follow(a)})}s.responsive&&o.bind("resize",function(){n.isFullscreen()||n.resize()});s.fullscreenDoubleTap&&this.$("stage").bind("touchstart",function(){var e,t,r,i,s,o,u=function(e){return e.originalEvent.touches?e.originalEvent.touches[0]:e};n.$("stage").bind("touchmove",function(){e=0});return function(a){if(/(-left|-right)/.test(a.target.className))return;o=_.timestamp();t=u(a).pageX;r=u(a).pageY;if(a.originalEvent.touches.length<2&&o-e<300&&t-i<20&&r-s<20){n.toggleFullscreen();a.preventDefault();return}e=o;i=t;s=r}}());e.each(t.on.binds,function(t,r){e.inArray(r.hash,n._binds)==-1&&n.bind(r.type,r.callback)});return this},addTimer:function(){this._timer.add.apply(this._timer,_.array(arguments));return this},clearTimer:function(){this._timer.clear.apply(this._timer,_.array(arguments));return this},_getWH:function(){var t=this.$("container"),n=this.$("target"),r=this,i={},s;e.each(["width","height"],function(e,o){if(r._options[o]&&typeof r._options[o]=="number")i[o]=r._options[o];else{s=[_.parseValue(t.css(o)),_.parseValue(n.css(o)),t[o](),n[o]()];r["_"+o]||s.splice(s.length,_.parseValue(t.css("min-"+o)),_.parseValue(n.css("min-"+o)));i[o]=Math.max.apply(Math,s)}});r._userRatio&&(i.height=i.width*r._userRatio);return i},_createThumbnails:function(n){this.get("total").innerHTML=this.getDataLength();var s,o,u,a,f,l=this,c=this._options,h=n?this._data.length-n.length:0,p=h,d=[],v=0,g=m<8?"http://upload.wikimedia.org/wikipedia/commons/c/c0/Blank.gif":"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw%3D%3D",y=function(){var e=l.$("thumbnails").find(".active");return e.length?e.find("img").attr("src"):!1}(),b=typeof c.thumbnails=="string"?c.thumbnails.toLowerCase():null,w=function(e){return i.defaultView&&i.defaultView.getComputedStyle?i.defaultView.getComputedStyle(o.container,null)[e]:f.css(e)},E=function(n,r,i){return function(){e(i).append(n);l.trigger({type:t.THUMBNAIL,thumbTarget:n,index:r,galleriaData:l.getData(r)})}},S=function(t){c.pauseOnInteraction&&l.pause();var n=e(t.currentTarget).data("index");l.getIndex()!==n&&l.show(n);t.preventDefault()},T=function(n,r){e(n.container).css("visibility","visible");l.trigger({type:t.THUMBNAIL,thumbTarget:n.image,index:n.data.order,galleriaData:l.getData(n.data.order)});typeof r=="function"&&r.call(l,n)},N=function(t,n){t.scale({width:t.data.width,height:t.data.height,crop:c.thumbCrop,margin:c.thumbMargin,canvas:c.useCanvas,position:c.thumbPosition,complete:function(t){var r=["left","top"],i=["Width","Height"],s,o,u=l.getData(t.index),a=u.thumb.split(":");e.each(i,function(n,i){s=i.toLowerCase();if(c.thumbCrop!==!0||c.thumbCrop===s){o={};o[s]=t[s];e(t.container).css(o);o={};o[r[n]]=0;e(t.image).css(o)}t["outer"+i]=e(t.container)["outer"+i](!0)});_.toggleQuality(t.image,c.thumbQuality===!0||c.thumbQuality==="auto"&&t.original.width<t.width*3);u.iframe&&a.length==2&&a[0]in x?x[a[0]].getThumb(a[1],function(e){return function(r){e.src=r;T(t,n)}}(t.image)):c.thumbDisplayOrder&&!t.lazy?e.each(d,function(e,t){if(e===v&&t.ready&&!t.displayed){v++;t.displayed=!0;T(t,n);return}}):T(t,n)}})};if(!n){this._thumbnails=[];this.$("thumbnails").empty()}for(;this._data[h];h++){u=this._data[h];s=u.thumb||u.image;if(c.thumbnails!==!0&&b!="lazy"||!u.thumb&&!u.image)if(u.iframe||b==="empty"||b==="numbers"){o={container:_.create("galleria-image"),image:_.create("img","span"),ready:!0};b==="numbers"&&e(o.image).text(h+1);u.iframe&&e(o.image).addClass("iframe");this.$("thumbnails").append(o.container);r.setTimeout(E(o.image,h,o.container),50+h*20)}else o={container:null,image:null};else{o=new t.Picture(h);o.index=h;o.displayed=!1;o.lazy=!1;o.video=!1;this.$("thumbnails").append(o.container);f=e(o.container);f.css("visibility","hidden");o.data={width:_.parseValue(w("width")),height:_.parseValue(w("height")),order:h,src:s};c.thumbCrop!==!0?f.css({width:"auto",height:"auto"}):f.css({width:o.data.width,height:o.data.height});a=s.split(":");if(a.length==2&&a[0]in x){o.video=!0;o.ready=!0;o.load(g,{height:o.data.height,width:o.data.height*1.25},N)}else if(b=="lazy"){f.addClass("lazy");o.lazy=!0;o.load(g,{height:o.data.height,width:o.data.width})}else o.load(s,N);c.preload==="all"&&o.preload(u.image)}e(o.container).add(c.keepSource&&c.linkSourceImages?u.original:null).data("index",h).bind(c.thumbEventType,S).data("thumbload",N);y===s&&e(o.container).addClass("active");this._thumbnails.push(o)}d=this._thumbnails.slice(p);return this},lazyLoad:function(t,n){var r=t.constructor==Array?t:[t],i=this,s=0;e.each(r,function(t,o){if(o>i._thumbnails.length-1)return;var u=i._thumbnails[o],a=u.data,f=function(){++s==r.length&&typeof n=="function"&&n.call(i)},l=e(u.container).data("thumbload");u.video?l.call(i,u,f):u.load(a.src,function(e){l.call(i,e,f)})});return this},lazyLoadChunks:function(e,t){var n=this.getDataLength(),i=0,s=0,o=[],u=[],a=this;t=t||0;for(;i<n;i++){u.push(i);if(++s==e||i==n-1){o.push(u);s=0;u=[]}}var f=function(e){var n=o.shift();n&&r.setTimeout(function(){a.lazyLoad(n,function(){f(!0)})},t&&e?t:0)};f(!1);return this},_run:function(){var i=this;i._createThumbnails();_.wait({timeout:1e4,until:function(){t.OPERA&&i.$("stage").css("display","inline-block");i._stageWidth=i.$("stage").width();i._stageHeight=i.$("stage").height();return i._stageWidth&&i._stageHeight>50},success:function(){C.push(i);if(i._options.swipe){var s=i.$("images").width(i.getDataLength()*i._stageWidth);e.each(new Array(i.getDataLength()),function(n){var r=new t.Picture;e(r.container).css({position:"absolute",top:0,left:i._stageWidth*n}).prepend(i._layers[n]=e(_.create("galleria-layer")).css({position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:2})[0]).appendTo(s);i._controls.slides.push(r)});i.finger.setup()}_.show(i.get("counter"));i._options.carousel&&i._carousel.bindControls();if(i._options.autoplay){i.pause();typeof i._options.autoplay=="number"&&(i._playtime=i._options.autoplay);i._playing=!0}if(i._firstrun){i._options.autoplay&&i.trigger(t.PLAY);typeof i._options.show=="number"&&i.show(i._options.show);return}i._firstrun=!0;t.History&&t.History.change(function(e){isNaN(e)?r.history.go(-1):i.show(e,n,!0)});i.trigger(t.READY);t.theme.init.call(i,i._options);e.each(t.ready.callbacks,function(e,t){typeof t=="function"&&t.call(i,i._options)});i._options.extend.call(i,i._options);/^[0-9]{1,4}$/.test(p)&&t.History?i.show(p,n,!0):i._data[i._options.show]&&i.show(i._options.show);i._options.autoplay&&i.trigger(t.PLAY)},error:function(){t.raise("Stage width or height is too small to show the gallery. Traced measures: width:"+i._stageWidth+"px, height: "+i._stageHeight+"px.",!0)}})},load:function(n,r,i){var s=this,o=this._options;this._data=[];this._thumbnails=[];this.$("thumbnails").empty();if(typeof r=="function"){i=r;r=null}n=n||o.dataSource;r=r||o.dataSelector;i=i||o.dataConfig;/^function Object/.test(n.constructor)&&(n=[n]);if(n.constructor===Array)this.validate(n)?this._data=n:t.raise("Load failed: JSON Array not valid.");else{r+=",.video,.iframe";e(n).find(r).each(function(t,n){n=e(n);var r={},o=n.parent(),u=o.attr("href"),a=o.attr("rel");u&&(n[0].nodeName=="IMG"||n.hasClass("video"))&&T(u)?r.video=u:u&&n.hasClass("iframe")?r.iframe=u:r.image=r.big=u;a&&(r.big=a);e.each("big title description link layer".split(" "),function(e,t){n.data(t)&&(r[t]=n.data(t).toString())});s._data.push(e.extend({title:n.attr("title")||"",thumb:n.attr("src"),image:n.attr("src"),big:n.attr("src"),description:n.attr("alt")||"",link:n.attr("longdesc"),original:n.get(0)},r,i(n)))})}typeof o.dataSort=="function"?u.sort.call(this._data,o.dataSort):o.dataSort=="random"&&this._data.sort(function(){return Math.round(Math.random())-.5});this.getDataLength()&&this._parseData().trigger(t.DATA);return this},_parseData:function(){var t=this,n;e.each(this._data,function(r,i){n=t._data[r];"thumb"in i==0&&(n.thumb=i.image);!1 in i&&(n.big=i.image);if("video"in i){var s=T(i.video);if(s){n.iframe=x[s.provider].embed(s.id)+function(){if(typeof t._options[s.provider]=="object"){var n="?",r=[];e.each(t._options[s.provider],function(e,t){r.push(e+"="+t)});s.provider=="youtube"&&(r=["wmode=opaque"].concat(r));return n+r.join("&")}return""}();delete n.video;if(!("thumb"in n)||!n.thumb)n.thumb=s.provider+":"+s.id}}});return this},destroy:function(){this.$("target").data("galleria",null);this.$("container").unbind("galleria");this.get("target").innerHTML=this._original.html;this.clearTimer();_.removeFromArray(k,this);_.removeFromArray(C,this);return this},splice:function(){var e=this,t=_.array(arguments);r.setTimeout(function(){u.splice.apply(e._data,t);e._parseData()._createThumbnails()},2);return e},push:function(){var e=this,t=_.array(arguments);t.length==1&&t[0].constructor==Array&&(t=t[0]);r.setTimeout(function(){u.push.apply(e._data,t);e._parseData()._createThumbnails(t)},2);return e},_getActive:function(){return this._controls.getActive()},validate:function(e){return!0},bind:function(e,t){e=S(e);this.$("container").bind(e,this.proxy(t));return this},unbind:function(e){e=S(e);this.$("container").unbind(e);return this},trigger:function(t){t=typeof t=="object"?e.extend(t,{scope:this}):{type:S(t),scope:this};this.$("container").trigger(t);return this},addIdleState:function(e,t,n,r){this._idle.add.apply(this._idle,_.array(arguments));return this},removeIdleState:function(e){this._idle.remove.apply(this._idle,_.array(arguments));return this},enterIdleMode:function(){this._idle.hide();return this},exitIdleMode:function(){this._idle.showAll();return this},enterFullscreen:function(e){this._fullscreen.enter.apply(this,_.array(arguments));return this},exitFullscreen:function(e){this._fullscreen.exit.apply(this,_.array(arguments));return this},toggleFullscreen:function(e){this._fullscreen[this.isFullscreen()?"exit":"enter"].apply(this,_.array(arguments));return this},bindTooltip:function(e,t){this._tooltip.bind.apply(this._tooltip,_.array(arguments));return this},defineTooltip:function(e,t){this._tooltip.define.apply(this._tooltip,_.array(arguments));return this},refreshTooltip:function(e){this._tooltip.show.apply(this._tooltip,_.array(arguments));return this},openLightbox:function(){this._lightbox.show.apply(this._lightbox,_.array(arguments));return this},closeLightbox:function(){this._lightbox.hide.apply(this._lightbox,_.array(arguments));return this},getActiveImage:function(){var e=this._getActive();return e?e.image:n},getActiveThumb:function(){return this._thumbnails[this._active].image||n},getMousePosition:function(e){return{x:e.pageX-this.$("container").offset().left,y:e.pageY-this.$("container").offset().top}},addPan:function(t){if(this._options.imageCrop===!1)return;t=e(t||this.getActiveImage());var n=this,r=t.width()/2,i=t.height()/2,s=parseInt(t.css("left"),10),o=parseInt(t.css("top"),10),u=s||0,a=o||0,f=0,l=0,c=!1,h=_.timestamp(),p=0,d=0,v=function(e,n,r){if(e>0){d=Math.round(Math.max(e*-1,Math.min(0,n)));if(p!==d){p=d;if(m===8)t.parent()["scroll"+r](d*-1);else{var i={};i[r.toLowerCase()]=d;t.css(i)}}}},g=function(e){if(_.timestamp()-h<50)return;c=!0;r=n.getMousePosition(e).x;i=n.getMousePosition(e).y},y=function(e){if(!c)return;f=t.width()-n._stageWidth;l=t.height()-n._stageHeight;s=r/n._stageWidth*f*-1;o=i/n._stageHeight*l*-1;u+=(s-u)/n._options.imagePanSmoothness;a+=(o-a)/n._options.imagePanSmoothness;v(l,a,"Top");v(f,u,"Left")};if(m===8){t.parent().scrollTop(a*-1).scrollLeft(u*-1);t.css({top:0,left:0})}this.$("stage").unbind("mousemove",g).bind("mousemove",g);this.addTimer("pan"+n._id,y,50,!0);return this},proxy:function(e,t){if(typeof e!="function")return d;t=t||this;return function(){return e.apply(t,_.array(arguments))}},removePan:function(){this.$("stage").unbind("mousemove");this.clearTimer("pan"+this._id);return this},addElement:function(t){var n=this._dom;e.each(_.array(arguments),function(e,t){n[t]=_.create("galleria-"+t)});return this},attachKeyboard:function(e){this._keyboard.attach.apply(this._keyboard,_.array(arguments));return this},detachKeyboard:function(){this._keyboard.detach.apply(this._keyboard,_.array(arguments));return this},appendChild:function(e,t){this.$(e).append(this.get(t)||t);return this},prependChild:function(e,t){this.$(e).prepend(this.get(t)||t);return this},remove:function(e){this.$(_.array(arguments).join(",")).remove();return this},append:function(e){var t,n;for(t in e)if(e.hasOwnProperty(t))if(e[t].constructor===Array)for(n=0;e[t][n];n++)this.appendChild(t,e[t][n]);else this.appendChild(t,e[t]);return this},_scaleImage:function(t,n){t=t||this._controls.getActive();if(!t)return;var r,i=function(t){e(t.container).children(":first").css({top:Math.max(0,_.parseValue(t.image.style.top)),left:Math.max(0,_.parseValue(t.image.style.left)),width:_.parseValue(t.image.width),height:_.parseValue(t.image.height)})};n=e.extend({width:this._stageWidth,height:this._stageHeight,crop:this._options.imageCrop,max:this._options.maxScaleRatio,min:this._options.minScaleRatio,margin:this._options.imageMargin,position:this._options.imagePosition,iframelimit:this._options.maxVideoSize},n);if(this._options.layerFollow&&this._options.imageCrop!==!0)if(typeof n.complete=="function"){r=n.complete;n.complete=function(){r.call(t,t);i(t)}}else n.complete=i;else e(t.container).children(":first").css({top:0,left:0});t.scale(n);return this},updateCarousel:function(){this._carousel.update();return this},resize:function(t,r){if(typeof t=="function"){r=t;t=n}t=e.extend({width:0,height:0},t);var i=this,s=this.$("container");e.each(t,function(e,n){if(!n){s[e]("auto");t[e]=i._getWH()[e]}});e.each(t,function(e,t){s[e](t)});return this.rescale(r)},rescale:function(r,i,s){var o=this;if(typeof r=="function"){s=r;r=n}var u=function(){o._stageWidth=r||o.$("stage").width();o._stageHeight=i||o.$("stage").height();if(o._options.swipe){e.each(o._controls.slides,function(t,n){o._scaleImage(n);e(n.container).css("left",o._stageWidth*t)});o.$("images").css("width",o._stageWidth*o.getDataLength())}else o._scaleImage();o._options.carousel&&o.updateCarousel();o.trigger(t.RESCALE);typeof s=="function"&&s.call(o)};u.call(o);return this},refreshImage:function(){this._scaleImage();this._options.imagePan&&this.addPan();return this},show:function(n,r,i){var s=this._options.swipe;if(!s&&(this._queue.length>3||n===!1||!this._options.queue&&this._queue.stalled))return;n=Math.max(0,Math.min(parseInt(n,10),this.getDataLength()-1));r=typeof r!="undefined"?!!r:n<this.getIndex();i=i||!1;if(!i&&t.History){t.History.set(n.toString());return}if(s&&n!==this._active){this.finger.to=-(n*this.finger.width);this.finger.index=n}this._active=n;if(s){var o=this.getData(n),a=this;if(!o)return;var f=o.iframe||(this.isFullscreen()&&"big"in o?o.big:o.image),l=this._controls.slides[n],c=l.isCached(f),h=this._thumbnails[n],p={cached:c,index:n,rewind:r,imageTarget:l.image,thumbTarget:h.image,galleriaData:o};this.trigger(e.extend(p,{type:t.LOADSTART}));var d=function(r){a._layers[n].innerHTML=a.getData().layer||"";a.trigger(e.extend(p,{type:t.LOADFINISH}));a._playCheck()};if(!l.ready)l.load(f,function(n){a._scaleImage(n,d).trigger(e.extend(p,{type:t.IMAGE}));d()});else{a.trigger(e.extend(p,{type:t.LOADFINISH}));d()}}else{u.push.call(this._queue,{index:n,rewind:r});this._queue.stalled||this._show()}return this},_show:function(){var i=this,s=this._queue[0],o=this.getData(s.index);if(!o)return;var a=o.iframe||(this.isFullscreen()&&"big"in o?o.big:o.image),f=this._controls.getActive(),l=this._controls.getNext(),c=l.isCached(a),h=this._thumbnails[s.index],p=function(){e(l.image).trigger("mouseup")},d=function(n,s,o,a,f){return function(){var l;D.active=!1;_.toggleQuality(s.image,i._options.imageQuality);i._layers[i._controls.active].innerHTML="";e(o.container).css({zIndex:0,opacity:0}).show();o.isIframe&&e(o.container).find("iframe").remove();i.$("container").toggleClass("iframe",!!n.iframe);e(s.container).css({zIndex:1,left:0,top:0}).show();i._controls.swap();i._options.imagePan&&i.addPan(s.image);(n.link||i._options.lightbox||i._options.clicknext)&&e(s.image).css({cursor:"pointer"}).bind("mouseup",function(e){if(typeof e.which=="number"&&e.which>1)return;if(i._options.clicknext&&!t.TOUCH){i._options.pauseOnInteraction&&i.pause();i.next();return}if(n.link){i._options.popupLinks?l=r.open(n.link,"_blank"):r.location.href=n.link;return}i._options.lightbox&&i.openLightbox()});i._playCheck();i.trigger({type:t.IMAGE,index:a.index,imageTarget:s.image,thumbTarget:f.image,galleriaData:n});u.shift.call(i._queue);i._queue.stalled=!1;i._queue.length&&i._show()}}(o,l,f,s,h);this._options.carousel&&this._options.carouselFollow&&this._carousel.follow(s.index);if(this._options.preload){var v,m,g=this.getNext(),y;try{for(m=this._options.preload;m>0;m--){v=new t.Picture;y=i.getData(g);v.preload(this.isFullscreen()&&"big"in y?y.big:y.image);g=i.getNext(g)}}catch(b){}}_.show(l.container);l.isIframe=!!o.iframe;e(i._thumbnails[s.index].container).addClass("active").siblings(".active").removeClass("active");i.trigger({type:t.LOADSTART,cached:c,index:s.index,rewind:s.rewind,imageTarget:l.image,thumbTarget:h.image,galleriaData:o});i._queue.stalled=!0;l.load(a,function(r){var u=e(i._layers[1-i._controls.active]).html(o.layer||"").hide();i._scaleImage(r,{complete:function(r){"image"in f&&_.toggleQuality(f.image,!1);_.toggleQuality(r.image,!1);i.removePan();i.setInfo(s.index);i.setCounter(s.index);if(o.layer){u.show();(o.link||i._options.lightbox||i._options.clicknext)&&u.css("cursor","pointer").unbind("mouseup").mouseup(p)}var a=i._options.transition;e.each({initial:f.image===null,touch:t.TOUCH,fullscreen:i.isFullscreen()},function(e,t){if(t&&i._options[e+"Transition"]!==n){a=i._options[e+"Transition"];return!1}});if(a in D.effects==0)d();else{var l={prev:f.container,next:r.container,rewind:s.rewind,speed:i._options.transitionSpeed||400};D.active=!0;D.init.call(i,a,l,d)}i.trigger({type:t.LOADFINISH,cached:c,index:s.index,rewind:s.rewind,imageTarget:r.image,thumbTarget:i._thumbnails[s.index].image,galleriaData:i.getData(s.index)})}})})},getNext:function(e){e=typeof e=="number"?e:this.getIndex();return e===this.getDataLength()-1?0:e+1},getPrev:function(e){e=typeof e=="number"?e:this.getIndex();return e===0?this.getDataLength()-1:e-1},next:function(){this.getDataLength()>1&&this.show(this.getNext(),!1);return this},prev:function(){this.getDataLength()>1&&this.show(this.getPrev(),!0);return this},get:function(e){return e in this._dom?this._dom[e]:null},getData:function(e){return e in this._data?this._data[e]:this._data[this._active]},getDataLength:function(){return this._data.length},getIndex:function(){return typeof this._active=="number"?this._active:!1},getStageHeight:function(){return this._stageHeight},getStageWidth:function(){return this._stageWidth},getOptions:function(e){return typeof e=="undefined"?this._options:this._options[e]},setOptions:function(t,n){typeof t=="object"?e.extend(this._options,t):this._options[t]=n;return this},play:function(e){this._playing=!0;this._playtime=e||this._playtime;this._playCheck();this.trigger(t.PLAY);return this},pause:function(){this._playing=!1;this.trigger(t.PAUSE);return this},playToggle:function(e){return this._playing?this.pause():this.play(e)},isPlaying:function(){return this._playing},isFullscreen:function(){return this._fullscreen.active},_playCheck:function(){var e=this,n=0,r=20,i=_.timestamp(),s="play"+this._id;if(this._playing){this.clearTimer(s);var o=function(){n=_.timestamp()-i;if(n>=e._playtime&&e._playing){e.clearTimer(s);e.next();return}if(e._playing){e.trigger({type:t.PROGRESS,percent:Math.ceil(n/e._playtime*100),seconds:Math.floor(n/1e3),milliseconds:n});e.addTimer(s,o,r)}};e.addTimer(s,o,r)}},setPlaytime:function(e){this._playtime=e;return this},setIndex:function(e){this._active=e;return this},setCounter:function(e){typeof e=="number"?e++:typeof e=="undefined"&&(e=this.getIndex()+1);this.get("current").innerHTML=e;if(m){var t=this.$("counter"),n=t.css("opacity");parseInt(n,10)===1?_.removeAlpha(t[0]):this.$("counter").css("opacity",n)}return this},setInfo:function(t){var n=this,r=this.getData(t);e.each(["title","description"],function(e,t){var i=n.$("info-"+t);r[t]?i[r[t].length?"show":"hide"]().html(r[t]):i.empty().hide()});return this},hasInfo:function(e){var t="title description".split(" "),n;for(n=0;t[n];n++)if(!!this.getData(e)[t[n]])return!0;return!1},jQuery:function(t){var n=this,r=[];e.each(t.split(","),function(t,i){i=e.trim(i);n.get(i)&&r.push(i)});var i=e(n.get(r.shift()));e.each(r,function(e,t){i=i.add(n.get(t))});return i},$:function(e){return this.jQuery.apply(this,_.array(arguments))}};e.each(w,function(e,n){var r=/_/.test(n)?n.replace(/_/g,""):n;t[n.toUpperCase()]="galleria."+r});e.extend(t,{IE9:m===9,IE8:m===8,IE7:m===7,IE6:m===6,IE:m,WEBKIT:/webkit/.test(h),CHROME:/chrome/.test(h),SAFARI:/safari/.test(h)&&!/chrome/.test(h),QUIRK:m&&i.compatMode&&i.compatMode==="BackCompat",MAC:/mac/.test(navigator.platform.toLowerCase()),OPERA:!!r.opera,IPHONE:/iphone/.test(h),IPAD:/ipad/.test(h),ANDROID:/android/.test(h),TOUCH:"ontouchstart"in i});t.addTheme=function(n){n.name||t.raise("No theme name specified");typeof n.defaults!="object"?n.defaults={}:n.defaults=E(n.defaults);var i=!1,s;if(typeof n.css=="string"){e("link").each(function(e,t){s=new RegExp(n.css);if(s.test(t.href)){i=!0;M(n);return!1}});i||e(function(){e("script").each(function(e,t){s=new RegExp("galleria\\."+n.name.toLowerCase()+"\\.");if(s.test(t.src)){i=t.src.replace(/[^\/]*$/,"")+n.css;r.setTimeout(function(){_.loadCSS(i,"galleria-theme",function(){M(n)})},1)}})});i||t.raise("No theme CSS loaded")}else M(n);return n};t.loadTheme=function(n,i){if(e("script").filter(function(){return e(this).attr("src")==n}).length)return;var s=!1,o;e(r).load(function(){s||(o=r.setTimeout(function(){!s&&!t.theme&&t.raise("Galleria had problems loading theme at "+n+". Please check theme path or load manually.",!0)},2e4))});t.unloadTheme();_.loadScript(n,function(){s=!0;r.clearTimeout(o)});return t};t.unloadTheme=function(){if(typeof t.theme=="object"){e("script").each(function(n,r){(new RegExp("galleria\\."+t.theme.name+"\\.")).test(r.src)&&e(r).remove()});t.theme=n}return t};t.get=function(e){if(!!k[e])return k[e];if(typeof e!="number")return k;t.raise("Gallery index "+e+" not found")};t.configure=function(n,r){var i={};if(typeof n=="string"&&r){i[n]=r;n=i}else e.extend(i,n);t.configure.options=i;e.each(t.get(),function(e,t){t.setOptions(i)});return t};t.configure.options={};t.on=function(n,r){if(!n)return;r=r||d;var i=n+r.toString().replace(/\s/g,"")+_.timestamp();e.each(t.get(),function(e,t){t._binds.push(i);t.bind(n,r)});t.on.binds.push({type:n,callback:r,hash:i});return t};t.on.binds=[];t.run=function(n,r){e.isFunction(r)&&(r={extend:r});e(n||"#galleria").galleria(r);return t};t.addTransition=function(e,n){D.effects[e]=n;return t};t.utils=_;t.log=function(){var t=_.array(arguments);if(!("console"in r&&"log"in r.console))return r.alert(t.join("<br>"));try{return r.console.log.apply(r.console,t)}catch(n){e.each(t,function(){r.console.log(this)})}};t.ready=function(n){if(typeof n!="function")return t;e.each(C,function(e,t){n.call(t,t._options)});t.ready.callbacks.push(n);return t};t.ready.callbacks=[];t.raise=function(t,n){var r=n?"Fatal error":"Error",i={color:"#fff",position:"absolute",top:0,left:0,zIndex:1e5},s=function(t){var s='<div style="padding:4px;margin:0 0 2px;background:#'+(n?"811":"222")+';">'+(n?"<strong>"+r+": </strong>":"")+t+"</div>";e.each(k,function(){var e=this.$("errors"),t=this.$("target");if(!e.length){t.css("position","relative");e=this.addElement("errors").appendChild("target","errors").$("errors").css(i)}e.append(s)});k.length||e("<div>").css(e.extend(i,{position:"fixed"})).append(s).appendTo(g().body)};if(f){s(t);if(n)throw new Error(r+": "+t)}else if(n){if(L)return;L=!0;n=!1;s("Gallery could not load.")}};t.version=a;t.requires=function(e,n){n=n||"You need to upgrade Galleria to version "+e+" to use one or more components.";t.version<e&&t.raise(n,!0);return t};t.Picture=function(t){this.id=t||null;this.image=null;this.container=_.create("galleria-image");e(this.container).css({overflow:"hidden",position:"relative"});this.original={width:0,height:0};this.ready=!1;this.isIframe=!1};t.Picture.prototype={cache:{},show:function(){_.show(this.image)},hide:function(){_.moveOut(this.image)},clear:function(){this.image=null},isCached:function(e){return!!this.cache[e]},preload:function(t){e(new Image).load(function(e,t){return function(){t[e]=e}}(t,this.cache)).attr("src",t)},load:function(n,i,s){if(typeof i=="function"){s=i;i=null}if(this.isIframe){var o="if"+(new Date).getTime();this.image=e("<iframe>",{src:n,frameborder:0,id:o,allowfullscreen:!0,css:{visibility:"hidden"}})[0];e(this.container).find("iframe,img").remove();this.container.appendChild(this.image);e("#"+o).load(function(t,n){return function(){r.setTimeout(function(){e(t.image).css("visibility","visible");typeof n=="function"&&n.call(t,t)},10)}}(this,s));return this.container}this.image=new Image;t.IE8&&e(this.image).css("filter","inherit");var u=!1,a=!1,f=e(this.container),l=e(this.image),h=function(){if(!u){u=!0;r.setTimeout(function(e,t){return function(){e.attr("src",t+"?"+_.timestamp())}}(e(this),n),50)}else c?e(this).attr("src",c):t.raise("Image not found: "+n)},p=function(n,s,o){return function(){var u=function(){e(this).unbind("load");n.original=i||{height:this.height,width:this.width};t.HAS3D&&(this.style.MozTransform=this.style.webkitTransform="translate3d(0,0,0)");n.container.appendChild(this);n.cache[o]=o;typeof s=="function"&&r.setTimeout(function(){s.call(n,n)},1)};!this.width||!this.height?r.setTimeout(function(n){return function(){if(n.width&&n.height)u.call(n);else if(!a){e(new Image).load(p).attr("src",n.src);a=!0}else t.raise("Could not extract width/height from image: "+n.src+". Traced measures: width:"+n.width+"px, height: "+n.height+"px.")}}(this),2):u.call(this)}}(this,s,n);f.find("iframe,img").remove();l.css("display","block");_.hide(this.image);e.each("minWidth minHeight maxWidth maxHeight".split(" "),function(e,t){l.css(t,/min/.test(t)?"0":"none")});l.load(p).bind("error",h).attr("src",n);return this.container},scale:function(r){var i=this;r=e.extend({width:0,height:0,min:n,max:n,margin:0,complete:d,position:"center",crop:!1,canvas:!1,iframelimit:n},r);if(this.isIframe){var s=r.width,o=r.height,u,a;if(r.iframelimit){var f=Math.min(r.iframelimit/s,r.iframelimit/o);if(f<1){u=s*f;a=o*f;e(this.image).css({top:o/2-a/2,left:s/2-u/2,position:"absolute"})}else e(this.image).css({top:0,left:0})}e(this.image).width(u||s).height(a||o).removeAttr("width").removeAttr("height");e(this.container).width(s).height(o);r.complete.call(i,i);try{this.image.contentWindow&&e(this.image.contentWindow).trigger("resize")}catch(l){}return this.container}if(!this.image)return this.container;var c,h,p=e(i.container),v;_.wait({until:function(){c=r.width||p.width()||_.parseValue(p.css("width"));h=r.height||p.height()||_.parseValue(p.css("height"));return c&&h},success:function(){var t=(c-r.margin*2)/i.original.width,n=(h-r.margin*2)/i.original.height,s=Math.min(t,n),o=Math.max(t,n),u={"true":o,width:t,height:n,"false":s,landscape:i.original.width>i.original.height?o:s,portrait:i.original.width<i.original.height?o:s},a=u[r.crop.toString()],f="";r.max&&(a=Math.min(r.max,a));r.min&&(a=Math.max(r.min,a));e.each(["width","height"],function(t,n){e(i.image)[n](i[n]=i.image[n]=Math.round(i.original[n]*a))});e(i.container).width(c).height(h);if(r.canvas&&A){A.elem.width=i.width;A.elem.height=i.height;f=i.image.src+":"+i.width+"x"+i.height;i.image.src=A.cache[f]||function(e){A.context.drawImage(i.image,0,0,i.original.width*a,i.original.height*a);try{v=A.elem.toDataURL();A.length+=v.length;A.cache[e]=v;return v}catch(t){return i.image.src}}(f)}var l={},p={},d=function(t,n,r){var s=0;if(/\%/.test(t)){var o=parseInt(t,10)/100,u=i.image[n]||e(i.image)[n]();s=Math.ceil(u*-1*o+r*o)}else s=_.parseValue(t);return s},m={top:{top:0},left:{left:0},right:{left:"100%"},bottom:{top:"100%"}};e.each(r.position.toLowerCase().split(" "),function(e,t){t==="center"&&(t="50%");l[e?"top":"left"]=t});e.each(l,function(t,n){m.hasOwnProperty(n)&&e.extend(p,m[n])});l=l.top?e.extend(l,p):p;l=e.extend({top:"50%",left:"50%"},l);e(i.image).css({position:"absolute",top:d(l.top,"height",h),left:d(l.left,"width",c)});i.show();i.ready=!0;r.complete.call(i,i)},error:function(){t.raise("Could not scale image: "+i.image.src)},timeout:1e3});return this}};e.extend(e.easing,{galleria:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t+n:r/2*((t-=2)*t*t+2)+n},galleriaIn:function(e,t,n,r,i){return r*(t/=i)*t+n},galleriaOut:function(e,t,n,r,i){return-r*(t/=i)*(t-2)+n}});t.Fastclick=function(){var n=/iP(ad|hone|od)/.test(navigator.userAgent),s=n&&/OS 4_\d(_\d)?/.test(navigator.userAgent),o=n&&/OS ([6-9]|\d{2})_\d/.test(navigator.userAgent);return{init:function(n){var i,s=this;this.trackingClick=!1;this.trackingClickStart=0;this.targetElement=null;this.touchStartX=0;this.touchStartY=0;this.lastTouchIdentifier=0;this.layer=n;e.each(["Click","TouchStart","TouchMove","TouchEnd","TouchCancel"],function(e,t){s["on"+t]=function(e){return function(){e.apply(s,arguments)}}(s["on"+t])});if(!t.TOUCH)return;n.addEventListener("click",this.onClick,!0);n.addEventListener("touchstart",this.onTouchStart,!1);n.addEventListener("touchmove",this.onTouchMove,!1);n.addEventListener("touchend",this.onTouchEnd,!1);n.addEventListener("touchcancel",this.onTouchCancel,!1);if(!r.Event.prototype.stopImmediatePropagation){n.removeEventListener=function(e,t,i){var s=r.Node.prototype.removeEventListener;e==="click"?s.call(n,e,t.hijacked||t,i):s.call(n,e,t,i)};n.addEventListener=function(e,t,i){var s=r.Node.prototype.addEventListener;e==="click"?s.call(n,e,t.hijacked||(t.hijacked=function(e){e.propagationStopped||t(e)}),i):s.call(n,e,t,i)}}if(typeof n.onclick=="function"){i=n.onclick;n.addEventListener("click",function(e){i(e)},!1);n.onclick=null}},sendClick:function(e,t){var n,s;i.activeElement&&i.activeElement!==e&&i.activeElement.blur();s=t.changedTouches[0];n=i.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,r,1,s.screenX,s.screenY,s.clientX,s.clientY,!1,!1,!1,!1,0,null);n.forwardedTouchEvent=!0;e.dispatchEvent(n)},onTouchStart:function(e){var t,i,o;t=e.target;i=e.targetTouches[0];if(n){o=r.getSelection();if(o.rangeCount&&!o.isCollapsed)return!0;if(!s){if(i.identifier===this.lastTouchIdentifier){e.preventDefault();return!1}this.lastTouchIdentifier=i.identifier}}this.trackingClick=!0;this.trackingClickStart=e.timeStamp;this.targetElement=t;this.touchStartX=i.pageX;this.touchStartY=i.pageY;e.timeStamp-this.lastClickTime<200&&e.preventDefault();return!0},touchHasMoved:function(e){var t=e.targetTouches[0];return Math.abs(t.pageX-this.touchStartX)>10||Math.abs(t.pageY-this.touchStartY)>10?!0:!1},onTouchMove:function(e){if(!this.trackingClick)return!0;if(this.targetElement!==e.target||this.touchHasMoved(e)){this.trackingClick=!1;this.targetElement=null}return!0},onTouchEnd:function(e){var t,n,s,u=this.targetElement;if(!this.trackingClick)return!0;if(e.timeStamp-this.lastClickTime<200){this.cancelNextClick=!0;return!0}this.lastClickTime=e.timeStamp;t=this.trackingClickStart;this.trackingClick=!1;this.trackingClickStart=0;if(o){s=e.changedTouches[0];u=e.target;u=i.elementFromPoint(s.pageX-r.pageXOffset,s.pageY-r.pageYOffset)}n=u.tagName.toLowerCase();e.preventDefault();this.sendClick(u,e);return!1},onTouchCancel:function(){this.trackingClick=!1;this.targetElement=null},onClick:function(e){var t;if(!this.targetElement)return!0;if(e.forwardedTouchEvent)return!0;t=this.targetElement;this.targetElement=null;if(this.trackingClick){this.trackingClick=!1;return!0}if(!e.cancelable)return!0;if(this.cancelNextClick){this.cancelNextClick=!1;e.stopImmediatePropagation?e.stopImmediatePropagation():e.propagationStopped=!0;e.stopPropagation();e.preventDefault();return!1}return!0}}}();t.Finger=function(){var n=Math.abs,o=t.HAS3D=function(){var t=i.createElement("p"),n,r=["webkit","O","ms","Moz",""],s,o=0,u="transform";g().html.insertBefore(t,null);for(;r[o];o++){s=r[o]?r[o]+"Transform"
:u;if(t.style[s]!==undefined){t.style[s]="translate3d(1px,1px,1px)";n=e(t).css(r[o]?"-"+r[o].toLowerCase()+"-"+u:u)}}g().html.removeChild(t);return n!==undefined&&n.length>0&&n!=="none"}(),u=function(){var e="RequestAnimationFrame";return r.requestAnimationFrame||r["webkit"+e]||r["moz"+e]||r["o"+e]||r["ms"+e]||function(e){r.setTimeout(e,1e3/60)}}(),a=function(t,n){this.config={start:0,duration:240,onchange:function(){},oncomplete:function(){},easing:function(e,t,n,r,i){return-r*((t=t/i-1)*t*t*t-1)+n}};if(!t.children.length)return;var i=this;e.extend(this.config,n);this.elem=t;this.child=t.children[0];this.to=this.pos=0;this.touching=!1;this.start={};this.index=this.config.start;this.anim=0;if(!o){this.child.style.position="absolute";this.elem.style.position="relative"}e.each(["ontouchstart","ontouchmove","ontouchend","setup"],function(e,t){i[t]=function(e){return function(){e.apply(i,arguments)}}(i[t])});this.setX=function(){var e=i.child.style;if(!o){e.left=i.pos+"px";return}e.MozTransform=e.webkitTransform="translate3d("+i.pos+"px,0,0)";return};e(t).bind("touchstart",this.ontouchstart);e(r).bind("resize",this.setup);e(r).bind("orientationchange",this.setup);this.setup();(function s(){u(s);i.loop.call(i)})()};a.prototype={constructor:a,setup:function(){this.width=e(this.elem).width();this.length=Math.ceil(e(this.child).width()/this.width);if(this.index!==0){this.index=Math.max(0,Math.min(this.index,this.length-1));this.pos=this.to=-this.width*this.index}},ontouchstart:function(e){var t=e.originalEvent.touches;this.start={pageX:t[0].pageX,pageY:t[0].pageY,time:+(new Date)};this.isScrolling=null;this.touching=!0;this.deltaX=0;s.bind("touchmove",this.ontouchmove);s.bind("touchend",this.ontouchend)},ontouchmove:function(e){var t=e.originalEvent.touches;if(t&&t.length>1||e.scale&&e.scale!==1||i.documentElement.clientWidth!==r.innerWidth)return;this.deltaX=t[0].pageX-this.start.pageX;this.isScrolling===null&&(this.isScrolling=!!(this.isScrolling||n(this.deltaX)<n(t[0].pageY-this.start.pageY)));if(!this.isScrolling){e.preventDefault();this.deltaX/=!this.index&&this.deltaX>0||this.index==this.length-1&&this.deltaX<0?n(this.deltaX)/this.width+1.8:1;this.to=this.deltaX-this.index*this.width}e.stopPropagation()},ontouchend:function(e){this.touching=!1;var t=+(new Date)-this.start.time<250&&n(this.deltaX)>40||n(this.deltaX)>this.width/2,r=!this.index&&this.deltaX>0||this.index==this.length-1&&this.deltaX<0;this.isScrolling||this.show(this.index+(t&&!r?this.deltaX<0?1:-1:0));s.unbind("touchmove",this.ontouchmove);s.unbind("touchend",this.ontouchend)},show:function(e){e!=this.index?this.config.onchange.call(this,e):this.to=-(e*this.width)},loop:function(){var e=this.to-this.pos;if(this.touching||n(e)<=1){this.pos=this.to;this.anim&&this.config.oncomplete(this.index);this.anim=0}else{this.anim||(this.anim={v:this.pos,c:e,t:0});this.pos=this.config.easing(null,this.anim.t++,this.anim.v,this.anim.c,this.config.duration/10)}this.setX()}};return a}();e.fn.galleria=function(n){var r=this.selector;if(!e(this).length){e(function(){e(r).length?e(r).galleria(n):t.utils.wait({until:function(){return e(r).length},success:function(){e(r).galleria(n)},error:function(){t.raise('Init failed: Galleria could not find the element "'+r+'".')},timeout:5e3})});return this}return this.each(function(){if(e.data(this,"galleria")){e.data(this,"galleria").destroy();e(this).find("*").hide()}e.data(this,"galleria",(new t).init(this,n))})}})(jQuery);